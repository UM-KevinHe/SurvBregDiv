% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/coxkl.R
\name{coxkl}
\alias{coxkl}
\title{Cox Proportional Hazards Model with KL Divergence for Data Integration}
\usage{
coxkl(
  z,
  delta,
  time,
  stratum = NULL,
  RS = NULL,
  beta = NULL,
  etas,
  tol = 1e-04,
  Mstop = 100,
  backtrack = FALSE,
  message = FALSE,
  data_sorted = FALSE,
  beta_initial = NULL
)
}
\arguments{
\item{z}{Numeric matrix of covariates. Rows represent observations, columns represent predictor variables.}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed event or censoring times.}

\item{stratum}{Optional numeric or factor vector defining strata.}

\item{RS}{Optional numeric vector or matrix of external risk scores. Length must equal the number of observations.
If not supplied, \code{beta} must be provided.}

\item{beta}{Optional numeric vector of external coefficients. Length must equal the number of columns in \code{z}.
If provided, these are used to calculate risk scores internally. If not supplied, \code{RS} must be provided.}

\item{etas}{Numeric vector of tuning parameters. Controls the reliance on external information.
The function will sort these values and fit a model for each.}

\item{tol}{Numeric. Convergence tolerance for the optimization algorithm. Default is \code{1e-4}.}

\item{Mstop}{Integer. Maximum number of iterations for the optimization. Default is \code{100}.}

\item{backtrack}{Logical. If \code{TRUE}, applies backtracking line search during optimization. Default is \code{FALSE}.}

\item{message}{Logical. If \code{TRUE}, prints progress messages (e.g., progress bar) during fitting. Default is \code{FALSE}.}

\item{data_sorted}{Logical. Internal use. If \code{TRUE}, assumes data is already sorted by stratum and time.}

\item{beta_initial}{Optional numeric vector. Initial values for the coefficients for the first \code{eta}.}
}
\value{
An object of class \code{"coxkl"} containing:
\describe{
\item{\code{eta}}{The sorted sequence of \eqn{\eta} values used.}
\item{\code{beta}}{Matrix of estimated coefficients (\eqn{p \times n_{etas}}). Columns correspond to \code{eta} values.}
\item{\code{linear.predictors}}{Matrix of linear predictors (risk scores) for each \code{eta}.}
\item{\code{likelihood}}{Vector of negative log-partial likelihoods for each \code{eta}.}
\item{\code{data}}{List containing the input data used (\code{z}, \code{time}, \code{delta}, \code{stratum}, \code{RS}).}
}
}
\description{
Fits a series of Cox proportional hazards models that incorporate external information
using Kullbackâ€“Leibler (KL) divergence.

External information can be supplied either as:
\itemize{
\item Precomputed external risk scores (\code{RS}).
\item Externally derived coefficients (\code{beta}).
}
The strength of integration is controlled by a sequence of tuning parameters (\code{etas}).
The function fits a model for each \code{eta} value provided.
}
\details{
The objective function is a weighted combination of the internal partial likelihood
and the KL divergence from the external information.
\itemize{
\item Larger values of \code{eta} place more weight on the external information.
\item \code{eta = 0} corresponds to the standard Cox model relying solely on internal data.
}
The function uses a "warm start" strategy where the solution for the current \code{eta}
is used as the initial value for the next \code{eta} in the sorted sequence.
}
\examples{
\dontrun{
# Load example data
data(ExampleData_lowdim)
train_dat_lowdim <- ExampleData_lowdim$train
beta_external_lowdim <- ExampleData_lowdim$beta_external_fair

# Generate a sequence of eta values
eta_list <- generate_eta(method = "exponential", n = 50, max_eta = 10)

# Fit the model
coxkl_est <- coxkl(
  z = train_dat_lowdim$z,
  delta = train_dat_lowdim$status,
  time = train_dat_lowdim$time,
  stratum = train_dat_lowdim$stratum,
  beta = beta_external_lowdim,
  etas = eta_list
)
}
}
