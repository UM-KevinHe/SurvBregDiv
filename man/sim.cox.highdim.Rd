% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation_funs.R
\name{sim.cox.highdim}
\alias{sim.cox.highdim}
\title{Simulate stratified Cox PH survival data with flexible censoring, optional binary covariates, and optional ties}
\usage{
sim.cox.highdim(
  n_stratum = 1,
  n.beta,
  beta_value_vec,
  beta_idx = NULL,
  mu_Z = NULL,
  sd_Z = NULL,
  stratum_size = 1000,
  rho = 0.1,
  censor_rate = 0.3,
  censor_type = c("uniform", "exponential", "weibull", "lognormal", "none"),
  max_time = Inf,
  seed = NULL,
  baseline = c("exponential", "weibull"),
  alpha = NULL,
  censor_weibull_shape = 1.5,
  censor_lognormal_sdlog = 1,
  binary_idx = integer(0),
  binary_prev = 0.5,
  rho_binary = 0.1,
  ties = FALSE,
  ties_levels = 50
)
}
\arguments{
\item{n_stratum}{Integer. Number of strata.}

\item{n.beta}{Integer. Total number of covariates \eqn{p}.}

\item{beta_value_vec}{Numeric vector. True coefficients for the first
\code{length(beta_value_vec)} covariates. Remaining coefficients (up to \code{n.beta}) are set
to 0.}

\item{beta_idx}{Integer vector or \code{NULL}. Indices (in \code{1:n.beta}) of covariates with
nonzero true coefficients. If \code{NULL}, defaults to \code{1:length(beta_value_vec)} (the
original behavior). Must have the same length as \code{beta_value_vec} after filtering to
valid indices.}

\item{mu_Z}{Numeric vector or \code{NULL}. Mean vector for the continuous covariates. If
\code{NULL}, a zero vector is used. For indices in \code{binary_idx}, \code{mu_Z} is ignored.}

\item{stratum_size}{Integer or numeric vector. Stratum sample sizes. If a scalar, it is recycled
to length \code{n_stratum}; if a vector, it must have length \code{n_stratum}.}

\item{rho}{Numeric. Correlation parameter in \eqn{[0,1)} for the equicorrelation covariance
structure used to generate continuous covariates.}

\item{censor_rate}{Numeric. Target random censoring rate in \eqn{[0,1)}. If 0, no random censoring
is applied (administrative censoring via \code{max_time} may still apply).}

\item{censor_type}{Character. Random censoring distribution. One of \code{"uniform"},
\code{"exponential"}, \code{"weibull"}, \code{"lognormal"}, or \code{"none"}.}

\item{max_time}{Numeric. Administrative censoring time. Observed time is
\code{min(event, censor, max_time)}.}

\item{seed}{Integer or \code{NULL}. Random seed for reproducibility.}

\item{baseline}{Character. Baseline hazard type. One of \code{"exponential"} or \code{"weibull"}.}

\item{alpha}{Numeric or \code{NULL}. Required when \code{baseline="weibull"}. Controls the Weibull
baseline hazard \eqn{h_0(t)=\alpha t}; must be positive and finite. Ignored when
\code{baseline="exponential"}.}

\item{censor_weibull_shape}{Numeric. Shape parameter \eqn{k>0} for Weibull random censoring when
\code{censor_type="weibull"}. The scale parameter is calibrated internally to match
\code{censor_rate}. Ignored otherwise.}

\item{censor_lognormal_sdlog}{Numeric. Log-scale standard deviation \eqn{\sigma_c>0} for log-normal
random censoring when \code{censor_type="lognormal"}. The mean on the log scale is calibrated
internally to match \code{censor_rate}. Ignored otherwise.}

\item{binary_idx}{Integer vector. Indices (in \code{1:n.beta}) of covariates to be generated as
binary. Default is none (all covariates continuous).}

\item{binary_prev}{Numeric scalar or vector. Prevalence \eqn{P(Z_j=1)} for binary covariates. If a
scalar, it is recycled to all binary covariates. Must be in \eqn{(0,1)}.}

\item{rho_binary}{Numeric. Equicorrelation parameter in \eqn{[0,1)} for the latent Gaussian vector
used to generate binary covariates. Ignored if \code{binary_idx} is empty.}

\item{ties}{Logical. If \code{TRUE}, discretize observed times to induce ties.}

\item{ties_levels}{Integer. Number of bins used to discretize time when \code{ties=TRUE}. Smaller
values yield stronger ties. Must be \eqn{\ge 2}.}
}
\value{
A list with components:
\itemize{
\item \code{data_combined}: A \code{data.frame} with columns \code{stratum}, \code{status},
\code{time}, and covariates \code{Z1...Zp}.
\item \code{data}: A list containing \code{stratum}, \code{Z}, \code{time}, and \code{status}.
\item \code{true_beta}: Numeric vector of length \code{n.beta} with the true coefficients used.
\item \code{meta}: A list of metadata including stratum parameters, baseline settings, censoring
configuration, binary-covariate configuration, ties configuration, and the actual censoring
rate achieved.
}
}
\description{
Internal function to generate time-to-event data under a stratified Cox proportional hazards model
with high-dimensional covariates, stratum-specific multiplicative baseline scaling, and
controllable random censoring. Event times are generated by inverse transform sampling using the
baseline cumulative hazard.

The model is
\deqn{h(t \mid Z, s) = \gamma_s \, h_0(t)\, \exp(Z^\top \beta),}
where \eqn{\gamma_s} is a stratum-specific positive constant, \eqn{h_0(t)} is the baseline hazard,
and \eqn{\beta} is the coefficient vector.

Supported baseline hazards:
\itemize{
\item \code{"exponential"}: \eqn{h_0(t)=1}, so \eqn{H_0(t)=t}.
\item \code{"weibull"}: \eqn{h_0(t)=\alpha t} with \eqn{\alpha>0}, so \eqn{H_0(t)=\alpha t^2/2}.
}

Censoring is implemented as
\deqn{T_{\mathrm{obs}} = \min(T, C, \texttt{max_time}),}
where \eqn{C} is a random censoring time drawn from a specified distribution and calibrated to
approximately match the target censoring rate.

Supported random censoring distributions:
\itemize{
\item \code{"uniform"}: \eqn{C \sim \mathrm{Unif}(0, c_{\max})}.
\item \code{"exponential"}: \eqn{C \sim \mathrm{Exp}(\lambda_c)}.
\item \code{"weibull"}: \eqn{C \sim \mathrm{Weibull}(k, \lambda_c)}, with shape \eqn{k} specified by
\code{censor_weibull_shape}.
\item \code{"lognormal"}: \eqn{C \sim \mathrm{LogNormal}(\mu_c, \sigma_c^2)}, with
\eqn{\sigma_c} specified by \code{censor_lognormal_sdlog}.
\item \code{"none"}: no random censoring; only administrative censoring via \code{max_time}.
}

Binary covariates can be specified by index via \code{binary_idx}. These variables are generated
using a latent Gaussian threshold model to achieve a desired prevalence and an approximate
within-binary correlation controlled by \code{rho_binary}. Specifically, if \eqn{B} is binary with
\eqn{P(B=1)=p}, it is generated as \eqn{B = I(L > c)} where \eqn{L} is standard normal and
\eqn{c=\Phi^{-1}(1-p)}. When multiple binary covariates are requested, their latent variables are
generated jointly with an equicorrelation \code{rho_binary}. This controls latent (tetrachoric)
correlation; the resulting Pearson correlation among binary variables is constrained by prevalence
and will generally be close but not identical to \code{rho_binary}.

If \code{ties=TRUE}, observed times are discretized into \code{ties_levels} bins (based on sample
quantiles) and replaced by bin midpoints to induce tied event/censoring times. Smaller
\code{ties_levels} produces stronger ties.
}
\details{
Continuous covariates (those not in \code{binary_idx}) are generated independently within each
stratum from a multivariate normal distribution with mean given by \code{mu_Z} (restricted to the
continuous indices) and an equicorrelation covariance matrix with diagonal 1 and off-diagonal
\code{rho}.

Stratum-specific scaling factors are sampled as \eqn{\gamma_s \sim \mathrm{Unif}(0,2)} and applied
multiplicatively to the hazard.

For \code{baseline="weibull"}, the implied event-time distribution (conditional on \eqn{Z} and
stratum) is Weibull with shape 2 under the parameterization \eqn{h_0(t)=\alpha t}.
}
\keyword{internal}
