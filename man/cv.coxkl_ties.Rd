% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cv.coxkl_ties.R
\name{cv.coxkl_ties}
\alias{cv.coxkl_ties}
\title{Cross-Validated Cox–KL with Ties Handling to Tune the Integration Parameter (eta)}
\usage{
cv.coxkl_ties(
  z,
  delta,
  time,
  stratum = NULL,
  beta = NULL,
  etas = NULL,
  ties = c("breslow", "exact"),
  tol = 1e-04,
  Mstop = 100,
  nfolds = 5,
  criteria = c("CIndex_pooled", "V&VH", "LinPred", "CIndex_foldaverage"),
  c_index_stratum = NULL,
  message = FALSE,
  seed = NULL,
  comb_max = 1e+07,
  ...
)
}
\arguments{
\item{z}{Numeric matrix of covariates (rows = observations, columns = variables).}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed event or censoring times.}

\item{stratum}{Optional numeric or factor vector defining strata.}

\item{beta}{Numeric vector of external coefficients. \strong{Required}.}

\item{etas}{Numeric vector of candidate tuning values to be cross-validated.}

\item{ties}{Character string specifying the method for handling ties. Must be one of
\code{"breslow"} (default) or \code{"exact"}.}

\item{tol}{Convergence tolerance for the optimizer used inside \code{coxkl_ties}. Default \code{1e-4}.}

\item{Mstop}{Maximum number of Newton iterations used inside \code{coxkl_ties}. Default \code{100}.}

\item{nfolds}{Number of cross-validation folds. Default \code{5}.}

\item{criteria}{Character string specifying the performance criterion.
Choices are \code{"V&VH"}, \code{"LinPred"}, \code{"CIndex_pooled"}, or \code{"CIndex_foldaverage"}.
Default \code{"CIndex_pooled"}.}

\item{c_index_stratum}{Optional stratum vector. Used for C-index calculation on test sets.}

\item{message}{Logical; if \code{TRUE}, prints progress messages. Default \code{FALSE}.}

\item{seed}{Optional integer seed for reproducible fold assignment. Default \code{NULL}.}

\item{comb_max}{Integer. Maximum number of combinations for the \strong{Exact} partial likelihood calculation.
Only relevant if \code{ties = "exact"}. Default \code{1e7}.}

\item{...}{Additional arguments (currently ignored).}
}
\value{
A \code{list} of class \code{"cv.coxkl"} containing:
\describe{
\item{\code{internal_stat}}{A \code{data.frame} with one row per \code{eta} and the CV metric results.}
\item{\code{best}}{A list containing the \code{best_eta}, the corresponding \code{best_beta} from the full model fit, and the \code{criteria} used.}
\item{\code{criteria}}{The criterion used for selection.}
\item{\code{nfolds}}{The number of folds used.}
}
}
\description{
Performs K-fold cross-validation (CV) to select the optimal integration parameter \code{eta}
for the Cox Proportional Hazards model with Kullback–Leibler (KL) divergence data
integration, using the Breslow or Exact partial likelihood for tied event times.
}
\details{
The function returns results in the format of a \code{cv.coxkl} object, allowing
downstream processing compatible with non-ties-handling Cox-KL models. The
\code{ties} argument controls which form of the partial likelihood (PL) is used
for both model fitting and CV criterion calculation.
}
\examples{
\dontrun{
data(ExampleData_lowdim)
train_dat_lowdim <- ExampleData_lowdim$train
train_dat_lowdim$time <- round(train_dat_lowdim$time, 2)  # Rounding time introduces ties for demonstration
eta_list <- generate_eta(method = "exponential", n = 50, max_eta = 10)

coxkl_ties.fit_breslow <- cv.coxkl_ties(
    z = train_dat_lowdim$z,
    delta = train_dat_lowdim$status,
    time = train_dat_lowdim$time,
    stratum = train_dat_lowdim$stratum,
    beta = ExampleData_lowdim$beta_external_fair,
    etas = eta_list,
    ties = "breslow",
    nfolds = 5,
    criteria = "V&VH",
    seed = 42
)
}
}
