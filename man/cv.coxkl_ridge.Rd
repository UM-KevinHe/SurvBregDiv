% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cv.coxkl_ridge.R
\name{cv.coxkl_ridge}
\alias{cv.coxkl_ridge}
\title{Cross-Validation for CoxKL Ridge Model (Tuning Eta and Lambda)}
\usage{
cv.coxkl_ridge(
  z,
  delta,
  time,
  stratum = NULL,
  RS = NULL,
  beta = NULL,
  etas,
  lambda = NULL,
  nlambda = 100,
  lambda.min.ratio = NULL,
  nfolds = 5,
  cv.criteria = c("V&VH", "LinPred", "CIndex_pooled", "CIndex_foldaverage"),
  c_index_stratum = NULL,
  message = FALSE,
  seed = NULL,
  ...
)
}
\arguments{
\item{z}{Numeric matrix of covariates. Rows represent individuals and columns represent predictors.}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed times (event or censoring).}

\item{stratum}{Optional numeric or factor vector indicating strata. If \code{NULL},
all subjects are assumed to be in the same stratum.}

\item{RS}{Optional numeric vector or matrix of external risk scores. If not provided,
\code{beta} must be supplied.}

\item{beta}{Optional numeric vector of external coefficients (length equal to \code{ncol(z)}).
If provided, used to compute external risk scores. If not provided, \code{RS} must be supplied.}

\item{etas}{Numeric vector of candidate \code{eta} values to be evaluated.}

\item{lambda}{Optional numeric vector of lambda values. If \code{NULL}, a path is generated automatically.}

\item{nlambda}{Integer. Number of lambda values to generate if \code{lambda} is \code{NULL}. Default is 100.}

\item{lambda.min.ratio}{Numeric. Ratio of min/max lambda. If \code{NULL} (default),
it is set to 0.01 if \code{n < p} and 1e-04 otherwise.}

\item{nfolds}{Integer. Number of cross-validation folds. Default is \code{5}.}

\item{cv.criteria}{Character string specifying the cross-validation criterion for selecting
parameters. Choices are:
\itemize{
\item \code{"V&VH"} (default): Verweij & Van Houwelingen partial likelihood loss.
\item \code{"LinPred"}: Loss based on the prognostic performance of the linear predictor.
\item \code{"CIndex_pooled"}: Harrell's C-index computed by pooling predictions across folds.
\item \code{"CIndex_foldaverage"}: Harrell's C-index computed within each fold and averaged.
}}

\item{c_index_stratum}{Optional stratum vector. Required only when \code{cv.criteria} is set
to \code{"CIndex_pooled"} or \code{"CIndex_foldaverage"} and stratification is needed for
evaluation but not for model fitting. Default is \code{NULL}.}

\item{message}{Logical. Whether to print progress messages. Default is \code{FALSE}.}

\item{seed}{Optional integer. Random seed for reproducible fold assignment.}

\item{...}{Additional arguments passed to the underlying fitting function \code{\link{coxkl_ridge}}.}
}
\value{
An object of class \code{"cv.coxkl_ridge"}. A list containing:
\describe{
\item{\code{best}}{A list with the optimal parameters:
\itemize{
\item \code{best_eta}: The selected eta value.
\item \code{best_lambda}: The selected lambda value.
\item \code{best_beta}: The coefficient vector corresponding to the best parameters.
\item \code{criteria}: The criterion used for selection.
}
}
\item{\code{integrated_stat.full_results}}{A \code{data.frame} containing the performance score
(and loss if applicable) for every combination of \code{eta} and \code{lambda}.}
\item{\code{integrated_stat.best_per_eta}}{A \code{data.frame} summarizing the best lambda
and corresponding score for each candidate \code{eta}.}
\item{\code{integrated_stat.betahat_best}}{A matrix of coefficients where each column corresponds
to the optimal model for a specific \code{eta}.}
\item{\code{criteria}}{The selection criterion used.}
\item{\code{nfolds}}{The number of folds used.}
}
}
\description{
Performs k-fold cross-validation to tune the hyperparameters for the Cox proportional
hazards model with Kullbackâ€“Leibler (KL) divergence penalty and Ridge (L2) regularization.

The function operates in two layers:
\enumerate{
\item \strong{Outer Loop (Eta):} Iterates through user-provided \code{etas} to control the weight of external information.
\item \strong{Inner Loop (Lambda):} For each \code{eta}, performs cross-validation to select the optimal Ridge penalty parameter \code{lambda}.
}
}
\examples{
\dontrun{
data(ExampleData_highdim)
train_dat_highdim <- ExampleData_highdim$train
beta_external_highdim <- ExampleData_highdim$beta_external
eta_list <- generate_eta(method = "exponential", n = 50, max_eta = 10)

cv.coxkl_ridge_est <- cv.coxkl_ridge(
   z = train_dat_highdim$z,
   delta = train_dat_highdim$status,
   time = train_dat_highdim$time,
   stratum = train_dat_highdim$stratum,
   beta = beta_external_highdim,
   etas = eta_list,
   cv.criteria = "CIndex_pooled"
)
}

}
