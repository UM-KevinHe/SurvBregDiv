% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cv.clogitkl_enet.R
\name{cv.clogitkl_enet}
\alias{cv.clogitkl_enet}
\title{Cross-Validated CLR-KL with Elastic Net Penalty}
\usage{
cv.clogitkl_enet(
  y,
  z,
  stratum,
  RS = NULL,
  beta = NULL,
  etas = NULL,
  alpha = 1,
  lambda = NULL,
  nlambda = 100,
  lambda.min.ratio = NULL,
  nfolds = 5,
  criteria = c("loss", "AUC", "CIndex", "Brier"),
  message = FALSE,
  seed = NULL,
  ...
)
}
\arguments{
\item{y}{Numeric vector of binary outcomes (0 = control, 1 = case).
In the 1:m matched case–control setting, each stratum must contain exactly
one case.}

\item{z}{Numeric matrix of covariates (rows = observations, columns = variables).}

\item{stratum}{Numeric or factor vector defining the matched sets (strata).
Each unique value identifies one matched set.}

\item{RS}{Optional numeric vector or matrix of external risk scores.
If not provided, \code{beta} must be supplied.}

\item{beta}{Optional numeric vector of external coefficients. If provided,
length must equal the number of columns in \code{z}. Either \code{RS} or
\code{beta} must be non-\code{NULL}.}

\item{etas}{Numeric vector of candidate tuning values for the integration
parameter \eqn{\eta}. The values will be sorted in ascending order.}

\item{alpha}{Elastic Net mixing parameter in \eqn{(0,1]}. Default is
\code{1} (lasso penalty).}

\item{lambda}{Optional numeric vector of lambda values. If \code{NULL}, a
lambda path is generated automatically for each \code{eta}.}

\item{nlambda}{Integer. Number of lambda values to generate when
\code{lambda} is \code{NULL}. Default \code{100}.}

\item{lambda.min.ratio}{Numeric in \eqn{(0,1)}. Ratio of minimum to maximum
lambda when \code{lambda} is \code{NULL}. If \code{NULL}, it is set
internally to \code{0.05} when \code{n < p}, and \code{1e-3} otherwise.}

\item{nfolds}{Number of cross-validation folds. Default \code{5}.}

\item{criteria}{Character string specifying the CV performance criterion.
Choices are:
\itemize{
\item \code{"loss"}: Average negative conditional log-likelihood
(lower is better).
\item \code{"AUC"}: Matched-set AUC based on within-stratum comparisons
(higher is better).
\item \code{"CIndex"}: Concordance index in the matched-set setting,
implemented via the same matched-set AUC calculation as \code{"AUC"}
(higher is better).
\item \code{"Brier"}: Conditional Brier score using within-stratum
softmax probabilities (lower is better).
}
Default is \code{"loss"}.}

\item{message}{Logical; if \code{TRUE}, prints progress messages. Default
\code{FALSE}.}

\item{seed}{Optional integer seed for reproducible fold assignment. Default
\code{NULL}.}

\item{...}{Additional arguments passed to \code{\link{clogitkl_enet}}.}
}
\value{
A \code{list} of class \code{"cv.clogitkl_enet"} containing:
\describe{
\item{\code{best}}{A list with the global best \eqn{(\eta, \lambda)}:
\itemize{
\item \code{best_eta}: Selected \code{eta}.
\item \code{best_lambda}: Selected \code{lambda}.
\item \code{best_beta}: Coefficient vector from the full-data fit at
\code{(best_eta, best_lambda)}.
\item \code{criteria}: The criterion used.
}
}
\item{\code{integrated_stat.full_results}}{A \code{data.frame} with one row
per \code{(eta, lambda)} combination and the corresponding CV score.}
\item{\code{integrated_stat.best_per_eta}}{A \code{data.frame} with one row
per \code{eta}, containing the best \code{lambda} and its score.}
\item{\code{integrated_stat.betahat_best}}{A matrix of coefficients where
each column is the full-data coefficient vector corresponding to the
best \code{lambda} for a given \code{eta}.}
\item{\code{criteria}}{The CV criterion used.}
\item{\code{alpha}}{The Elastic Net mixing parameter.}
\item{\code{nfolds}}{The number of folds used.}
}
}
\description{
Performs K-fold cross-validation (CV) to jointly select the integration
parameter \code{eta} and the Elastic Net penalty parameter \code{lambda}
for Conditional Logistic Regression with Kullback–Leibler (KL)
divergence and Elastic Net penalty, implemented via \code{\link{clogitkl_enet}}.

This function is designed for 1:m matched case–control settings where each
stratum (matched set) contains exactly one case and \eqn{m} controls.
}
\details{
The matched case–control problem is handled via \code{\link{clogitkl_enet}},
which maps Conditional Logistic Regression to a Cox model with fixed event
time and uses \code{\link{coxkl_enet}} as the core engine.

Cross-validation is performed at the stratum level: each matched set is
treated as an indivisible unit and assigned to a single fold using
\code{\link{get_fold_cc}}. This ensures that the conditional likelihood is
well-defined within each training and test split.

For each candidate \code{eta}, a full \code{lambda} path is fit on the
complete data (via \code{\link{clogitkl_enet}}), and then K-fold CV is used
to evaluate each \code{lambda} along this path according to the chosen
\code{criteria}. The function therefore performs a 2D search over
\eqn{(\eta, \lambda)}.

The \code{criteria} argument controls the CV performance metric:
\itemize{
\item \code{"loss"}: Average negative conditional log-likelihood on held-out
strata (lower is better).
\item \code{"AUC"}: Matched-set AUC based on within-stratum comparisons
(higher is better).
\item \code{"CIndex"}: Alias for \code{"AUC"} in the 1:m matched setting
(higher is better).
\item \code{"Brier"}: Conditional Brier score based on within-stratum
softmax probabilities (lower is better).
}
}
\examples{
\dontrun{
data(ExampleData_cc_highdim)
train_cc <- ExampleData_cc_highdim$train

y        <- train_cc$y
z        <- train_cc$z
sets     <- train_cc$stratum
beta_ext <- ExampleData_cc_highdim$beta_external

eta_list <- generate_eta(method = "exponential", n = 30, max_eta = 20)

cv_fit <- cv.clogitkl_enet(
  y        = y,
  z        = z,
  stratum  = sets,
  beta     = beta_ext,
  etas     = eta_list,
  alpha    = 1,
  nfolds   = 5,
  criteria = "loss",
  seed     = 42
)

cv_fit$best$best_eta
cv_fit$best$best_lambda
}

}
