% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/StabSelect.R
\name{coxkl_enet.StabSelect}
\alias{coxkl_enet.StabSelect}
\title{Stability Selection for KL-Integrated Cox Elastic-Net Models}
\usage{
coxkl_enet.StabSelect(
  z,
  delta,
  time,
  stratum = NULL,
  RS = NULL,
  beta = NULL,
  etas,
  alpha = 1,
  lambda = NULL,
  nlambda = 100,
  lambda.min.ratio = 0.1,
  nfolds = 5,
  cv.criteria = c("V&VH", "LinPred", "CIndex_pooled", "CIndex_foldaverage"),
  c_index_stratum = NULL,
  message = FALSE,
  seed = NULL,
  B = 50,
  fraction_sample = 0.5,
  ...
)
}
\arguments{
\item{z}{Numeric matrix of covariates. Rows represent individuals and columns represent predictors.}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed times (event or censoring).}

\item{stratum}{Optional numeric or factor vector indicating strata. If \code{NULL},
all subjects are assumed to be in the same stratum.}

\item{RS}{Optional numeric vector or matrix of external risk scores. If not provided,
\code{beta} must be supplied.}

\item{beta}{Optional numeric vector of external coefficients (length equal to \code{ncol(z)}).
If provided, it is used to compute external risk scores. If not provided, \code{RS} must be supplied.}

\item{etas}{Numeric vector of candidate \code{eta} values to be evaluated.}

\item{alpha}{Elastic-net mixing parameter in \eqn{(0,1]}. Default is \code{1} (lasso penalty).}

\item{lambda}{Optional numeric vector of lambda values. If \code{NULL}, a path is generated automatically.}

\item{nlambda}{Integer. Number of lambda values to generate if \code{lambda} is NULL. Default is 100.}

\item{lambda.min.ratio}{Numeric. Ratio of min/max lambda.
Default depends on sample size vs dimension (0.05 if n < p, else 1e-03).}

\item{nfolds}{Integer. Number of cross-validation folds. Default is \code{5}.}

\item{cv.criteria}{Character string specifying the cross-validation criterion for selecting
both \code{eta} and \code{lambda}. Choices are:
\itemize{
\item \code{"V&VH"} (default): V&VH loss.
\item \code{"LinPred"}: Loss based on cross-validated linear predictors.
\item \code{"CIndex_pooled"}: Pooled C-Index.
\item \code{"CIndex_foldaverage"}: Average C-Index across folds.
}}

\item{c_index_stratum}{Optional stratum vector. Required only when \code{cv.criteria} is set
to \code{"CIndex_pooled"} or \code{"CIndex_foldaverage"}, and a stratified C-index needs
to be computed while the fitted model is non-stratified. Default is \code{NULL}.}

\item{message}{Logical. Whether to print progress messages. Default is \code{FALSE}.}

\item{seed}{Optional integer. Random seed for reproducible fold assignment.}

\item{B}{Integer. Number of bootstrap/subsampling replicates used for
stability selection. Default is \code{50}.}

\item{fraction_sample}{Numeric in \code{(0, 1]}. Fraction of the original
sample size used in each replicate (without replacement if subsampling is
used). Default is \code{0.5}.}

\item{...}{Additional arguments passed to the underlying fitting function \code{\link{coxkl_enet}}.}
}
\value{
An object of class \code{"StabSelect"}, which is a list containing:
\item{stability_path}{A numeric matrix of dimension
\code{n_vars x n_lambda} giving, for each variable (rows) and each value of
\code{lambda} (columns), the empirical selection probability across the
\code{B} replicates.}
\item{lambda}{Numeric vector giving the global \code{lambda} sequence used
for the underlying elastic-net fits.}
}
\description{
Performs stability selection for the KL-integrated Cox elastic-net model
by repeatedly refitting the model on bootstrap or subsampled datasets and
aggregating variable selection frequencies across replicates. This procedure
provides a robust measure of variable importance that is less sensitive to
a single split of the data.
}
\examples{
\dontrun{
data(ExampleData_highdim)
train_dat_highdim      <- ExampleData_highdim$train
beta_external_highdim  <- ExampleData_highdim$beta_external

eta_list <- generate_eta(method = "exponential", n = 10, max_eta = 50)

coxkl.StabSelect <- coxkl_enet.StabSelect(
  z            = train_dat_highdim$z,
  delta        = train_dat_highdim$status,
  time         = train_dat_highdim$time,
  stratum      = train_dat_highdim$stratum,
  beta         = beta_external_highdim,
  etas         = eta_list,
  cv.criteria  = "CIndex_pooled",
  B            = 20,
  message      = TRUE
)

# Plot with different thresholds without re-running stability selection
plot(coxkl.StabSelect, threshold = 0.6)
plot(coxkl.StabSelect, threshold = 0.8)
}

}
