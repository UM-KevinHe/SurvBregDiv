<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cox Proportional Hazards Model with KL Divergence for Data Integration (Ties Handling) — coxkl_ties • SurvBregDiv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cox Proportional Hazards Model with KL Divergence for Data Integration (Ties Handling) — coxkl_ties"><meta name="description" content="Fits a series of Cox proportional hazards models that integrate external information,
specified as external coefficients (beta), using Kullback–Leibler (KL) divergence.
This version of the function is designed to handle tied event times using either
the Breslow or Exact partial likelihood approximation.
The strength of integration is controlled by a sequence of tuning parameters (etas).
The function fits a model for each eta value provided."><meta property="og:description" content="Fits a series of Cox proportional hazards models that integrate external information,
specified as external coefficients (beta), using Kullback–Leibler (KL) divergence.
This version of the function is designed to handle tied event times using either
the Breslow or Exact partial likelihood approximation.
The strength of integration is controlled by a sequence of tuning parameters (etas).
The function fits a model for each eta value provided."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-54921687-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-54921687-5');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SurvBregDiv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/SurvBregDiv.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-appendix" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Appendix</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-appendix"><li><a class="dropdown-item" href="../articles/CV_Criteria.html">CV Criteria</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/UM-KevinHe/SurvBregDiv" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cox Proportional Hazards Model with KL Divergence for Data Integration (Ties Handling)</h1>

      <div class="d-none name"><code>coxkl_ties.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a series of Cox proportional hazards models that integrate external information,
specified as external coefficients (<code>beta</code>), using Kullback–Leibler (KL) divergence.
This version of the function is designed to <strong>handle tied event times</strong> using either
the Breslow or Exact partial likelihood approximation.</p>
<p>The strength of integration is controlled by a sequence of tuning parameters (<code>etas</code>).
The function fits a model for each <code>eta</code> value provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">coxkl_ties</span><span class="op">(</span></span>
<span>  <span class="va">z</span>,</span>
<span>  <span class="va">delta</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  stratum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">beta</span>,</span>
<span>  <span class="va">etas</span>,</span>
<span>  ties <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  Mstop <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data_sorted <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  beta_initial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  comb_max <span class="op">=</span> <span class="fl">1e+07</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-z">z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>Numeric matrix of covariates. Rows represent observations, columns represent predictor variables.</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>Numeric vector of event indicators (1 = event, 0 = censored).</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>Numeric vector of observed event or censoring times.</p></dd>


<dt id="arg-stratum">stratum<a class="anchor" aria-label="anchor" href="#arg-stratum"></a></dt>
<dd><p>Optional numeric or factor vector defining strata.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>Numeric vector of external coefficients. Length must equal the number of columns in <code>z</code>.
These are used to compute the external risk scores and the KL divergence term.</p></dd>


<dt id="arg-etas">etas<a class="anchor" aria-label="anchor" href="#arg-etas"></a></dt>
<dd><p>Numeric vector of tuning parameters. Controls the reliance on external information.
The function will sort these values and fit a model for each.</p></dd>


<dt id="arg-ties">ties<a class="anchor" aria-label="anchor" href="#arg-ties"></a></dt>
<dd><p>Character string specifying the method for handling ties. Must be one of
<code>"breslow"</code> (default) or <code>"exact"</code>.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>Numeric. Convergence tolerance for the optimization algorithm (Newton-Raphson). Default is <code>1e-4</code>.</p></dd>


<dt id="arg-mstop">Mstop<a class="anchor" aria-label="anchor" href="#arg-mstop"></a></dt>
<dd><p>Integer. Maximum number of iterations for the optimization. Default is <code>100</code>.</p></dd>


<dt id="arg-message">message<a class="anchor" aria-label="anchor" href="#arg-message"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, prints progress messages (e.g., progress bar) during fitting. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-data-sorted">data_sorted<a class="anchor" aria-label="anchor" href="#arg-data-sorted"></a></dt>
<dd><p>Logical. Internal use. If <code>TRUE</code>, assumes data is already sorted by stratum and time.</p></dd>


<dt id="arg-beta-initial">beta_initial<a class="anchor" aria-label="anchor" href="#arg-beta-initial"></a></dt>
<dd><p>Optional numeric vector. Initial values for the coefficients for the first <code>eta</code>. Default is zero vector.</p></dd>


<dt id="arg-comb-max">comb_max<a class="anchor" aria-label="anchor" href="#arg-comb-max"></a></dt>
<dd><p>Integer. Maximum number of combinations to check for the <strong>Exact</strong> partial likelihood calculation,
preventing excessive computation time. Default is <code>1e7</code>. Only relevant if <code>ties = "exact"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"coxkl"</code> containing:</p><dl><dt><code>eta</code></dt>
<dd><p>The sorted sequence of \(\eta\) values used.</p></dd>

<dt><code>beta</code></dt>
<dd><p>Matrix of estimated coefficients (\(p \times n_{etas}\)). Columns correspond to <code>eta</code> values.</p></dd>

<dt><code>linear.predictors</code></dt>
<dd><p>Matrix of linear predictors (risk scores) for each <code>eta</code>.</p></dd>

<dt><code>likelihood</code></dt>
<dd><p>Vector of negative log-partial likelihoods for each <code>eta</code>.</p></dd>

<dt><code>data</code></dt>
<dd><p>List containing the input data used (<code>z</code>, <code>time</code>, <code>delta</code>, <code>stratum</code>).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The objective function is a weighted combination of the internal partial likelihood
and the KL divergence from the external information derived from <code>beta</code>.</p>
<ul><li><p><strong>KL Divergence and Weighting</strong>: Larger values of <code>eta</code> place more weight
on matching the risk set behavior implied by the external coefficients.</p></li>
<li><p><strong>Standard Cox</strong>: <code>eta = 0</code> corresponds to the standard Cox model, relying
solely on the internal partial likelihood.</p></li>
<li><p><strong>Ties Handling</strong>: The calculation of the partial likelihood uses the method
specified by the <code>ties</code> argument ("breslow" or "exact"). The exact method may be
computationally intensive for datasets with many tied events.</p></li>
</ul><p>The function uses a "warm start" strategy where the solution for the current <code>eta</code>
is used as the initial value for the next <code>eta</code> in the sorted sequence.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData_lowdim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train_dat_lowdim</span> <span class="op">&lt;-</span> <span class="va">ExampleData_lowdim</span><span class="op">$</span><span class="va">train</span></span></span>
<span class="r-in"><span><span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">time</span>, <span class="fl">2</span><span class="op">)</span>   <span class="co"># Rounding time introduces ties for demonstration</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">eta_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_eta.html">generate_eta</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exponential"</span>, n <span class="op">=</span> <span class="fl">50</span>, max_eta <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1. Fit the model using Breslow's approximation for ties (Default)</span></span></span>
<span class="r-in"><span><span class="va">coxkl_ties.fit_Breslow</span> <span class="op">&lt;-</span> <span class="fu">coxkl_ties</span><span class="op">(</span></span></span>
<span class="r-in"><span>    z <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">z</span>,</span></span>
<span class="r-in"><span>    delta <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">status</span>,</span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">time</span>,</span></span>
<span class="r-in"><span>    stratum <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">stratum</span>,</span></span>
<span class="r-in"><span>    beta <span class="op">=</span> <span class="va">ExampleData_lowdim</span><span class="op">$</span><span class="va">beta_external_fair</span>,</span></span>
<span class="r-in"><span>    etas <span class="op">=</span> <span class="va">eta_list</span>,</span></span>
<span class="r-in"><span>    ties <span class="op">=</span> <span class="st">"breslow"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2. Fit the model using the Exact method for ties</span></span></span>
<span class="r-in"><span><span class="va">coxkl_ties.fit_Exact</span> <span class="op">&lt;-</span> <span class="fu">coxkl_ties</span><span class="op">(</span></span></span>
<span class="r-in"><span>    z <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">z</span>,</span></span>
<span class="r-in"><span>    delta <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">status</span>,</span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">time</span>,</span></span>
<span class="r-in"><span>    stratum <span class="op">=</span> <span class="va">train_dat_lowdim</span><span class="op">$</span><span class="va">stratum</span>,</span></span>
<span class="r-in"><span>    beta <span class="op">=</span> <span class="va">ExampleData_lowdim</span><span class="op">$</span><span class="va">beta_external_fair</span>,</span></span>
<span class="r-in"><span>    etas <span class="op">=</span> <span class="va">eta_list</span>,</span></span>
<span class="r-in"><span>    ties <span class="op">=</span> <span class="st">"exact"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yubo Shao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

